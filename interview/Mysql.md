# Mysql

## 常见引擎

- InnoDB
- MyISAM
- CSV
- ARCHIVE
- MEMORY

## 事务

一组逻辑,要么全部成功执行,要不不执行.

四大特性:

1. 原子性: 最小分割单位的意思,要么全部完成,要么全部完成.意思是一个事务是一个最小任务,不可再分割.
2. 一致性: 执行事务前后,数据库必须由一个状态转变为另一个状态.
3. 隔离性: 并发的时候,各个事务互补不影响.
4. 持久性: 事务成功提交之后,对数据库的改变是持久的,就算数据库发生故障也不应该对其影响.

三种读问题:

1. 脏读: 事务为提交修改的情况下,其他事务读取了这个数据.
2. 不可重复读: 一个事务要多次读取数据的情况,其他事务修改这个数据,导致这个事务第二次甚至多次读取的数据都不一致.
3. 幻读: 一个事务第一次和第二次读取数据的中间,另外一个数据插入了数据,导致第一第二次读取的数据行数不一样.

四个隔离级别:

1. 未提交读: 没有解决任何问题
2. 提交读: 解决脏读.
3. 可重复读: 解决不可重复读和脏读的问题.(默认的级别)
4. 串行化: 解决脏读、幻读、不可重复读.
  
## MyISAM 与 InnoDB 的区别

特性 | MyISAM | InnoDB
---|---|---
行级锁 | 不支持(表级锁) | 支持
事务 | 不支持 | 支持
外键 | 不支持 | 支持
MVCC | 不支持 | 支持

适合场景:
- MyISAM: 适合读密集
- InnoDB: 适合大多数情况

## MVCC (multiversion concurrency control 多版本并发控制)

MVCC(Multiversion concurrency control) 就是 同一份数据临时保留多版本的一种方式，进而实现并发控制

## 大表优化

1. 限定数据范围,比如用日期
2. 读写分离,主从拆分
3. 垂直分区,将一行数据拆成多个表
4. 水平分区,将数据分片,存储到不同的表或者库中

## in exist 区别

in 是把外表和内表作hash 连接，而exists是对外表作loop循环，每次loop循环再对内表进行查询。一直以来认为exists比in效率高的说法是不准确的

## 悲观锁 乐观锁

- 悲观锁: 每次拿数据都认为别人会修改数据,所以都会上锁.
- 乐观锁: 假设不会发生冲突,只在提交操作检查是否违反数据完整性.